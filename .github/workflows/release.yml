# Copyright (c) Microsoft Corporation.
# Licensed under the MIT License.

---

name: Release – Phase 1

on:
  schedule:
    # Run every quarter.
    - cron: 0 0 1 */3 *
  workflow_dispatch:
    inputs:
      major:
        default: 1
        description: The major element of the version number
        required: true
        type: string
      minor:
        default: 4
        description: The minor element of the version number
        required: true
        type: string
      patch:
        default: 10
        description: The patch element of the version number
        required: true
        type: string

jobs:
  release:
    uses: ./.github/workflows/release-phase-1-internal.yml
    secrets: inherit
    with:
      major: ${{ inputs.major || 1 }}
      minor: ${{ inputs.minor || 4 }}
      patch: ${{ inputs.patch || 10 }}

...

# # Copyright (c) Microsoft Corporation.
# # Licensed under the MIT License.

# ---

# # TODO: Rename this file to release-phase-2.yml when testing is complete.

# name: Release - Phase 2

# on:
#   push:
#     branches:
#       - main
#     paths:
#       - .github/workflows/support/release-trigger.txt
#   # TODO: Remove line below when testing is complete.
#   workflow_dispatch: null

# jobs:
#   release:
#     name: Release
#     runs-on: ubuntu-latest
#     permissions:
#       contents: write
#       discussions: write
#     steps:
#       - name: Checkout
#         uses: actions/checkout@v3

#       - name: Install Node.js
#         uses: actions/setup-node@v3
#         with:
#           node-version: 19.x

#       - name: npm – Install Dependencies
#         shell: pwsh
#         run: npm install

#       - name: npm – Build
#         shell: pwsh
#         run: npm run build:release

#       - name: Install TFX CLI
#         shell: pwsh
#         run: npm install -g tfx-cli

#       - name: Release – Create
#         shell: pwsh
#         run: tfx extension create --manifest-globs vss-extension.json --output-path ../ms-omex.PRMetrics.vsix
#         working-directory: ${{ github.workspace }}/release

#       - name: Release – Publish
#         uses: actions/upload-artifact@v3
#         with:
#           name: ms-omex.PRMetrics
#           path: ${{ github.workspace }}/ms-omex.PRMetrics.vsix

#       - name: Get Version
#         id: version
#         shell: pwsh
#         run: |-
#           $Version = Get-Content -Path '.github/workflows/support/release-trigger.txt'
#           Write-Output -InputObject "VERSION=v$Version" >> $Env:GITHUB_OUTPUT

#       - name: GitHub Release
#         uses: softprops/action-gh-release@v0.1.15
#         with:
#           draft: true
#           discussion_category_name: Releases
#           files: ${{ github.workspace }}/ms-omex.PRMetrics.vsix
#           generate_realease_notes: true
#           tag_name: TEST Release v${{ steps.version.outputs.VERSION }}
#           tag: test-v${{ steps.version.outputs.VERSION }}

# ...
